.text
.thumb
.align 2

.include "anim_particle/particle_ids.s"
.include "defines/anim_macros.s"

NewPlayAnimationTable:
.byte 0x9E, 0x7E, 0x2D, 0x08, 0xD4, 0x7E, 0x2D, 0x08, 0xDD, 0x7E, 0x2D, 0x08, 0x1A, 0x7F, 0x2D, 0x08, 0x22, 0x7F, 0x2D, 0x08, 0x6A, 0x7F, 0x2D, 0x08, 0x75, 0x7F, 0x2D, 0x08
.byte 0x08, 0x81, 0x2D, 0x08, 0x7C, 0x81, 0x2D, 0x08, 0x58, 0x82, 0x2D, 0x08, 0xA5, 0x82, 0x2D, 0x08, 0xEE, 0x82, 0x2D, 0x08, 0xF3, 0x82, 0x2D, 0x08, 0xF8, 0x82, 0x2D, 0x08
.byte 0xFD, 0x82, 0x2D, 0x08, 0x0B, 0x83, 0x2D, 0x08, 0x3C, 0x83, 0x2D, 0x08, 0x61, 0x83, 0x2D, 0x08, 0xBF, 0x83, 0x2D, 0x08, 0x1E, 0x84, 0x2D, 0x08, 0xE3, 0x84, 0x2D, 0x08
.byte 0x23, 0x85, 0x2D, 0x08, 0x66, 0x85, 0x2D, 0x08, 0xE3, 0x85, 0x2D, 0x08, 0x04, 0x86, 0x2D, 0x08, 0x15, 0x86, 0x2D, 0x08, 0x26, 0x86, 0x2D, 0x08, 0x7A, 0x86, 0x2D, 0x08
.byte 0x93, 0x86, 0x2D, 0x08, 0x9D, 0x86, 0x2D, 0x08
.word MegaEvoAnimation
.word AlphaPrimalAnimation
.word OmegaPrimalAnimation
.word IllusionAnimation

IllusionAnimation:
	animA 0x1
	playsound2 0xCB 0xC0
	anim1D 0xCC 0xC0 0x30
	launchtask 0x0815B7D0 + 1 2 0x1
	.hword 0
	waitanimation
	animB 0x1
	endanimation

MegaEvoAnimation:
.equ ANIM_XX, 0x2800 + MEGA_EVOLUTION_RAINBOW_particle_ID
.equ ANIM_YY, 0x2800 + MEGA_EVOLUTION_STONE_particle_ID
.equ ANIM_ZZ, 0x2800 + MEGA_EVOLUTION_SYMBOL_particle_ID
	.byte 0x00 
	.hword ANIM_XX
	.byte 0x00 
	.hword ANIM_YY
	.byte 0x00 
	.hword ANIM_ZZ
	
	.byte 0x0A, 0x02 , 0x0C , 0x0C , 0x08 , 0x1C , 0x8C , 0x00 , 0xC0 , 0x0D , 0x03 
	.byte 0x03 , 0x05 , 0x5A , 0x11 , 0x08 , 0x02 , 0x06 , 0x02 , 0x00 , 0x00 , 0x00 
	.byte 0x06 , 0x00 , 0x00 , 0x00 , 0x0B , 0x00 , 0xFF , 0x2F 
	.byte 0x0E 
	.word anim_rainbow_x
	.byte 0x0E 
	.word anim_rainbow_x
	.byte 0x0E 
	.word anim_rainbow_x
	.byte 0x05

	@Load mega stone :

	.byte 0x0B, 0x02 , 0x0D , 0x04 , 0x00 , 0x17 , 0x0A , 0x00 , 0x0C , 0x0C , 0x08 , 0x19 , 0xC9 , 0x00 , 0xC0 
	.byte 0x02 
	.word anim_mega_stone_x
	.byte 0x29 , 0x04 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 

	@Whiteout screen:

	.byte 0x04 , 0x14 , 0x03 , 0x65 , 0x66 , 0x11 , 0x08 , 0x05 , 0x05 , 0x05 , 0x00 , 0x02 , 0x00 , 0x00 , 0x00 
	.byte 0x10 , 0x00 , 0xFF , 0xFF , 0x03 , 0x49 , 0x68 , 0x11 , 0x08 , 0x05 , 0x05 
	.hword ANIM_XX
	.byte 0x02 , 0x00 , 0x00 , 0x00 , 0x10 , 0x00 , 0xFF , 0xFF , 0x05 , 0x03 , 0x49 , 0x68 , 0x11 , 0x08 , 0x05

	.byte 0x0, 0x03 
	.word swap_sprite_routine+1
	.byte 0x02 , 0x00 
	
	@Return screen:

	.byte 0x00 , 0x2D , 0x27 , 0x03 , 0x65 , 0x66 , 0x11 , 0x08, 0x05 , 0x05 , 0x05 , 0x00 , 0x02 , 0x00 
	.byte 0x10 , 0x00 , 0x00 , 0x00 , 0xFF , 0xFF , 0x03 , 0xDD , 0x52 , 0x11 , 0x08 , 0x05 , 0x03 , 0x01 
	.byte 0x00 , 0x05 , 0x00 , 0x0E , 0x00 , 0x05

	@ Show Mega evolution symbol:

	.byte 0x02 
	.word anim_mega_symbol_x
	.byte 0x82 , 0x00 , 0x05 , 0x0B , 0x0D , 0x08 , 0x08
	
anim_rainbow_x:
	.byte 0x02
	.word anim_rainbow_y
	.byte 0x02, 0x03 , 0x28 , 0x00 , 0xF6, 0xFF, 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_rainbow_y
	.byte 0x02 , 0x03 , 0xDD , 0xFF , 0xF6 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_rainbow_y
	.byte 0x02 , 0x03 , 0x0F , 0x00 , 0xD8 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_rainbow_y
	.byte 0x02 , 0x03 , 0xF6 , 0xFF , 0xE0 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_rainbow_y
	.byte 0x02 , 0x03 , 0x19 , 0x00 , 0xEC , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_rainbow_y
	.byte 0x02 , 0x03 , 0xD8 , 0xFF , 0xEC , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_rainbow_y
	.byte 0x02 , 0x03 , 0x05 , 0x00 , 0xD8 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 , 0x0F 

anim_rainbow_y:
	.hword ANIM_XX
	.hword ANIM_XX
	.byte 0x8C , 0x4A , 0x52 , 0x08 , 0xC8 , 0x21 , 0x59 , 0x08 , 0x00 , 0x00 , 0x00 , 0x00 
	.byte 0xDC , 0x21 , 0x59 , 0x08 , 0xE1 , 0xE8 , 0x0F , 0x08

anim_mega_stone_x:
	.hword ANIM_YY
	.hword ANIM_YY
	.byte 0xFC , 0x4A , 0x52 , 0x08 , 0x9C , 0xC6 , 0x2E , 0x08 , 0x00 , 0x00 , 0x00 , 0x00 , 0x94
	.byte 0x68 , 0x59 , 0x08 , 0xC9 , 0x77 , 0x0A , 0x08 
	
anim_mega_symbol_x:
	.hword ANIM_ZZ
	.hword ANIM_ZZ
	.byte 0x34 , 0x4A , 0x52 , 0x08 , 0x9C , 0xC6 , 0x2E , 0x08 , 0x00 , 0x00 , 0x00 , 0x00
	.byte 0xA8 , 0xC6 , 0x2E , 0x08 , 0x79 , 0x2B , 0x11 , 0x08
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
AlphaPrimalAnimation:
.equ ANIM_ALPHA_XX, 0x2800+ALPHA_REVERSION_CHARGE_particle_ID
.equ ANIM_ALPHA_YY, 0x2800+ALPHA_REVERSION_STONE_particle_ID
.equ ANIM_ALPHA_ZZ, 0x2800+ALPHA_REVERSION_SYMBOL_particle_ID
	.byte 0x00 
	.hword ANIM_ALPHA_XX
	.byte 0x00 
	.hword ANIM_ALPHA_YY
	.byte 0x00 
	.hword ANIM_ALPHA_ZZ
	
	.byte 0x0A, 0x02 , 0x0C , 0x0C , 0x08 , 0x1C , 0x8C , 0x00 , 0xC0 , 0x0D , 0x03 
	.byte 0x03 , 0x05 , 0x5A , 0x11 , 0x08 , 0x02 , 0x06 , 0x02 , 0x00 , 0x00 , 0x00 
	.byte 0x06 , 0x00 , 0x00 , 0x00 , 0x0B , 0x00 , 0xFF , 0x2F 
	.byte 0x0E 
	.word anim_blue_charge
	.byte 0x0E 
	.word anim_blue_charge
	.byte 0x0E 
	.word anim_blue_charge
	.byte 0x05

	@Load alpha stone :

	.byte 0x0B, 0x02 , 0x0D , 0x04 , 0x00 , 0x17 , 0x0A , 0x00 , 0x0C , 0x0C , 0x08 , 0x19 , 0xC9 , 0x00 , 0xC0 
	.byte 0x02 
	.word anim_alpha_stone
	.byte 0x29 , 0x04 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 

	@Whiteout screen:

	.byte 0x04 , 0x14 , 0x03 , 0x65 , 0x66 , 0x11 , 0x08 , 0x05 , 0x05 , 0x05 , 0x00 , 0x02 , 0x00 , 0x00 , 0x00 
	.byte 0x10 , 0x00 , 0xFF , 0xFF , 0x03 , 0x49 , 0x68 , 0x11 , 0x08 , 0x05 , 0x05 
	.hword ANIM_ALPHA_XX
	.byte 0x02 , 0x00 , 0x00 , 0x00 , 0x10 , 0x00 , 0xFF , 0xFF , 0x05 , 0x03 , 0x49 , 0x68 , 0x11 , 0x08 , 0x05

	.byte 0x0, 0x03 
	.word swap_sprite_routine+1
	.byte 0x02 , 0x00 
	
	@Return screen:

	.byte 0x00 , 0x2D , 0x27 , 0x03 , 0x65 , 0x66 , 0x11 , 0x08, 0x05 , 0x05 , 0x05 , 0x00 , 0x02 , 0x00 
	.byte 0x10 , 0x00 , 0x00 , 0x00 , 0xFF , 0xFF , 0x03 , 0xDD , 0x52 , 0x11 , 0x08 , 0x05 , 0x03 , 0x01 
	.byte 0x00 , 0x05 , 0x00 , 0x0E , 0x00 , 0x05

	@ Show Alpha reversion symbol:

	.byte 0x02 
	.word anim_alpha_symbol
	.byte 0x82 , 0x00 , 0x05 , 0x0B , 0x0D , 0x08 , 0x08
	
anim_blue_charge:
	.byte 0x02
	.word anim_blue_charge_2
	.byte 0x02, 0x03 , 0x28 , 0x00 , 0xF6, 0xFF, 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_blue_charge_2
	.byte 0x02 , 0x03 , 0xDD , 0xFF , 0xF6 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_blue_charge_2
	.byte 0x02 , 0x03 , 0x0F , 0x00 , 0xD8 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_blue_charge_2
	.byte 0x02 , 0x03 , 0xF6 , 0xFF , 0xE0 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_blue_charge_2
	.byte 0x02 , 0x03 , 0x19 , 0x00 , 0xEC , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_blue_charge_2
	.byte 0x02 , 0x03 , 0xD8 , 0xFF , 0xEC , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_blue_charge_2
	.byte 0x02 , 0x03 , 0x05 , 0x00 , 0xD8 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 , 0x0F 

anim_blue_charge_2:
	.hword ANIM_ALPHA_XX
	.hword ANIM_ALPHA_XX
	.byte 0x8C , 0x4A , 0x52 , 0x08 , 0xC8 , 0x21 , 0x59 , 0x08 , 0x00 , 0x00 , 0x00 , 0x00 
	.byte 0xDC , 0x21 , 0x59 , 0x08 , 0xE1 , 0xE8 , 0x0F , 0x08

anim_alpha_stone:
	.hword ANIM_ALPHA_YY
	.hword ANIM_ALPHA_YY
	.byte 0xFC , 0x4A , 0x52 , 0x08 , 0x9C , 0xC6 , 0x2E , 0x08 , 0x00 , 0x00 , 0x00 , 0x00 , 0x94
	.byte 0x68 , 0x59 , 0x08 , 0xC9 , 0x77 , 0x0A , 0x08 
	
anim_alpha_symbol:
	.hword ANIM_ALPHA_ZZ
	.hword ANIM_ALPHA_ZZ
	.byte 0x34 , 0x4A , 0x52 , 0x08 , 0x9C , 0xC6 , 0x2E , 0x08 , 0x00 , 0x00 , 0x00 , 0x00
	.byte 0xA8 , 0xC6 , 0x2E , 0x08 , 0x79 , 0x2B , 0x11 , 0x08

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
OmegaPrimalAnimation:
.equ ANIM_OMEGA_XX, 0x2800+OMEGA_REVERSION_CHARGE_particle_ID
.equ ANIM_OMEGA_YY, 0x2800+OMEGA_REVERSION_STONE_particle_ID
.equ ANIM_OMEGA_ZZ, 0x2800+OMEGA_REVERSION_SYMBOL_particle_ID
	.byte 0x00 
	.hword ANIM_OMEGA_XX
	.byte 0x00 
	.hword ANIM_OMEGA_YY
	.byte 0x00 
	.hword ANIM_OMEGA_ZZ
	
	.byte 0x0A, 0x02 , 0x0C , 0x0C , 0x08 , 0x1C , 0x8C , 0x00 , 0xC0 , 0x0D , 0x03 
	.byte 0x03 , 0x05 , 0x5A , 0x11 , 0x08 , 0x02 , 0x06 , 0x02 , 0x00 , 0x00 , 0x00 
	.byte 0x06 , 0x00 , 0x00 , 0x00 , 0x0B , 0x00 , 0xFF , 0x2F 
	.byte 0x0E 
	.word anim_red_charge
	.byte 0x0E 
	.word anim_red_charge
	.byte 0x0E 
	.word anim_red_charge
	.byte 0x05

	@Load omega stone :

	.byte 0x0B, 0x02 , 0x0D , 0x04 , 0x00 , 0x17 , 0x0A , 0x00 , 0x0C , 0x0C , 0x08 , 0x19 , 0xC9 , 0x00 , 0xC0 
	.byte 0x02 
	.word anim_omega_stone
	.byte 0x29 , 0x04 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 

	@Whiteout screen:

	.byte 0x04 , 0x14 , 0x03 , 0x65 , 0x66 , 0x11 , 0x08 , 0x05 , 0x05 , 0x05 , 0x00 , 0x02 , 0x00 , 0x00 , 0x00 
	.byte 0x10 , 0x00 , 0xFF , 0xFF , 0x03 , 0x49 , 0x68 , 0x11 , 0x08 , 0x05 , 0x05 
	.hword ANIM_OMEGA_XX
	.byte 0x02 , 0x00 , 0x00 , 0x00 , 0x10 , 0x00 , 0xFF , 0xFF , 0x05 , 0x03 , 0x49 , 0x68 , 0x11 , 0x08 , 0x05

	.byte 0x0, 0x03 
	.word swap_sprite_routine+1
	.byte 0x02 , 0x00 
	
	@Return screen:

	.byte 0x00 , 0x2D , 0x27 , 0x03 , 0x65 , 0x66 , 0x11 , 0x08, 0x05 , 0x05 , 0x05 , 0x00 , 0x02 , 0x00 
	.byte 0x10 , 0x00 , 0x00 , 0x00 , 0xFF , 0xFF , 0x03 , 0xDD , 0x52 , 0x11 , 0x08 , 0x05 , 0x03 , 0x01 
	.byte 0x00 , 0x05 , 0x00 , 0x0E , 0x00 , 0x05

	@ Show omega symbol:

	.byte 0x02 
	.word anim_omega_symbol
	.byte 0x82 , 0x00 , 0x05 , 0x0B , 0x0D , 0x08 , 0x08
	
anim_red_charge:
	.byte 0x02
	.word anim_red_charge_2
	.byte 0x02, 0x03 , 0x28 , 0x00 , 0xF6, 0xFF, 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_red_charge_2
	.byte 0x02 , 0x03 , 0xDD , 0xFF , 0xF6 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_red_charge_2
	.byte 0x02 , 0x03 , 0x0F , 0x00 , 0xD8 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_red_charge_2
	.byte 0x02 , 0x03 , 0xF6 , 0xFF , 0xE0 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_red_charge_2
	.byte 0x02 , 0x03 , 0x19 , 0x00 , 0xEC , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_red_charge_2
	.byte 0x02 , 0x03 , 0xD8 , 0xFF , 0xEC , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 
	.byte 0x02 
	.word anim_red_charge_2
	.byte 0x02 , 0x03 , 0x05 , 0x00 , 0xD8 , 0xFF , 0x0D , 0x00 , 0x04 , 0x03 , 0x0F 

anim_red_charge_2:
	.hword ANIM_OMEGA_XX
	.hword ANIM_OMEGA_XX
	.byte 0x8C , 0x4A , 0x52 , 0x08 , 0xC8 , 0x21 , 0x59 , 0x08 , 0x00 , 0x00 , 0x00 , 0x00 
	.byte 0xDC , 0x21 , 0x59 , 0x08 , 0xE1 , 0xE8 , 0x0F , 0x08

anim_omega_stone:
	.hword ANIM_OMEGA_YY
	.hword ANIM_OMEGA_YY
	.byte 0xFC , 0x4A , 0x52 , 0x08 , 0x9C , 0xC6 , 0x2E , 0x08 , 0x00 , 0x00 , 0x00 , 0x00 , 0x94
	.byte 0x68 , 0x59 , 0x08 , 0xC9 , 0x77 , 0x0A , 0x08 
	
anim_omega_symbol:
	.hword ANIM_OMEGA_ZZ
	.hword ANIM_OMEGA_ZZ
	.byte 0x34 , 0x4A , 0x52 , 0x08 , 0x9C , 0xC6 , 0x2E , 0x08 , 0x00 , 0x00 , 0x00 , 0x00
	.byte 0xA8 , 0xC6 , 0x2E , 0x08 , 0x79 , 0x2B , 0x11 , 0x08


@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
swap_sprite_routine:
	push {r4-r7, lr}
	ldr r1, Attackeranim
	ldr r2, battle_side_objid
	ldrb r3, [r1]
	ldrb r2, [r2, r3]
	ldr r3, tasks
	mov r12, r3
	lsl r4, r0, #2
	add r4, r4, r0
	lsl r4, r4, #3
	add r4, r12
	mov r7, r4
	ldrh r3, [r4, #0x1C]
	cmp r3, #2
	beq AddTaskMaybe
	cmp r3, #0
	beq Hidingsprite
	cmp r3, #1
	beq WeRefreshGraphics
	cmp r3, #3
	beq TaskRunningSomething
	cmp r3, #4
	bne End
	lsl r3, r2, #4
	add r2, r3, r2
	ldr r3, somethingnotsureeither
	mov r12, r3
	lsl r2, r2, #2
	ldrh r3, [r4, #0x1E]
	add r2, r12
	strh r3, [r2]
	push {r0-r2}
	ldr r0, Attackeranim
	ldrb r0, [r0]
	mov r1, #0x58
	mul r1, r0
	ldr r2, = battle_participants
	add r1, r2
	ldrh r1, [r1]
	ldr r3, shadupdate
	bl Jump665
	pop {r0-r2}
	ldr r3, move_anim_task_del
	bl Jump665

End:
	pop {r4-r7, pc}

WeRefreshGraphics:
	ldr r3, Refreshgraphics
	ldrb r0, [r1]
	mov r1, #1
	bl Jump665

AddEnd:
	ldrh r3, [r4, #0x1C]
	add r3, #1
	strh r3, [r4, #0x1C]
	b End

Hidingsprite:
	ldr r0, somethingnotsureeither
	mov r12, r0
	lsl r3, r2, #4
	add r3, r3, r2
	lsl r3, r3, #2
	add r3, r12
	mov r5, r3
	ldrh r0, [r3]
	strh r0, [r4, #0x1E]
	mov r0, #0x40
	neg r0, r0
	strh r0, [r3]
	ldrh r3, [r4, #0x1C]
	add r3, #1
	strh r3, [r4, #0x1C]
	b End

TaskRunningSomething:
	ldr r3, task_find_id_by_funcptr
	ldr r0, SomeRoutine
	bl Jump665
	ldr r3, task_is_running
	bl Jump665
	cmp r0, #0
	bne End
	ldrh r3, [r4, #0x1C]
	add r3, #1
	strh r3, [r4, #0x1C]
	b End

AddTaskMaybe:
	lsl r3, r2, #4
	add r2, r3, r2
	ldr r3, somethingnotsure
	mov r12, r3
	mov r1, #4
	lsl r2, r2, #2
	add r2, r12
	ldrb  r3, [r2]
	bic r3, r1
	strb r3, [r2]
	ldr r0, SomeRoutine
	ldr r3, taskadd
	mov r1, #5
	ldr r6, tasks
	bl Jump665
	lsl r3, r0, #2
	add r0, r3, r0
	mov r3, #0
	lsl r0, r0, #3
	add r0, r6, r0
	strh r3, [r0, #8]
	ldr r3, Attackeranim
	ldrb r3, [r3]
	strh r3, [r0, #0xC]
	ldrh r3, [r4, #0x1C]
	add r3, #1
	strh r3, [r4, #0x1C]
	b End

Jump665:
	bx r3

.align 2
.pool
shadupdate: .word 0x805EE54+1
Attackeranim: .word 0x2038436
battle_side_objid: .word 0x20241E4
tasks: .word 0x3005E00
somethingnotsure: .word 0x202066E @@@ those are members of object struct
somethingnotsureeither: .word 0x2020650 @@@ those are members of object struct
SomeRoutine: .word 0x80A4980+1
taskadd: .word 0x80A8FB0+1
Refreshgraphics: .word 0x805E8F4+1
task_find_id_by_funcptr: .word 0x80A921C+1
task_is_running: .word 0x80A91E4+1
move_anim_task_del: .word 0x80A3C1C+1
